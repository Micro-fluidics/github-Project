<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/widget.css">
    <!-- Icon -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://kit.fontawesome.com/951fcb8c3d.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
   <script>
        // Firebase Configuration
        var firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase only once
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        } else {
            firebase.app(); // if already initialized, use that one
        }

        // Function to load the list of devices
        function LoadListDevice() {
            let list = JSON.parse(localStorage.getItem('Devices')) || [];
            if (list.length === 0) {
                // Initialize default device if the list is empty
                list.push({
                    id: Date.now(),
                    type: 'Pump1',
                    name: 'Forward',
                    folder: '1000',
                    location: '100'
                });
                localStorage.setItem('Devices', JSON.stringify(list));
            }
            let str = "";
            for (let i = 0; i < list.length; i++) {
                let x = list[i];
                str += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${x.type}</td>
                        <td>${x.name}</td>
                        <td>${x.folder}</td>
                        <td>${x.location}</td>
                        <td>
                            <button class="btn-form btn-small" onclick="EditDevice(${x.id})">Edit</button>
                            <button class="btn-form btn-small" onclick="DeleteDevice(${x.id})">Delete</button>
                            <button class="btn-form btn-small" onclick="moveDeviceUp(${x.id})">↑</button>
                            <button class="btn-form btn-small" onclick="moveDeviceDown(${x.id})">↓</button>
                        </td>
                    </tr>
                `;
            }
            document.getElementById("listDevice").innerHTML = str;
            document.getElementById('tongsosp').textContent = list.length;
            document.getElementById('tongsosp1').textContent = list.length;

            // Update SVG if any ADC sensor is present in the list
            list.forEach(device => {
                document.getElementById('type-device').value = device.type;
                document.getElementById('name-device').value = device.name;
                document.getElementById('folder').value = device.folder;
                document.getElementById('location').value = device.location;

                if (device.type === "ADC1" || device.type === "ADC2") {
                    updateDelayValue();  // Call the function to update the SVG for the specific ADC sensor
                }
            });

            createSmallerTable();
        }

        // Function to create a smaller table
        function createSmallerTable() {
            console.log("Creating smaller table...");
            // Get the table body of listDevice
            var listDeviceBody = document.getElementById("listDevice");
            if (!listDeviceBody) {
                console.error("listDevice body not found!");
                return;
            }

            // Create a new table body element for listDevice1
            var listDevice1Body = document.createElement("tbody");
            listDevice1Body.id = "listDevice1";

            // Create the first row with custom labels
            var labelRow = document.createElement("tr");
            var counterLabel = document.createElement("td");
            counterLabel.textContent = "   #";
            var sensorLabel = document.createElement("td");
            sensorLabel.textContent = " Sensor";
            var commandLabel = document.createElement("td");
            commandLabel.textContent = "Command";
            var timeOnLabel = document.createElement("td");
            timeOnLabel.textContent = "     Time On";
            var delayLabel = document.createElement("td");
            delayLabel.textContent = "     Delay";

            // Append the label row to listDevice1Body
            listDevice1Body.appendChild(labelRow);

            // Loop through each row in the original table starting from index 1
            for (var i = 0; i < listDeviceBody.rows.length; i++) {
                console.log("Copying row", i);
                // Clone the row
                var newRow = listDeviceBody.rows[i].cloneNode(true);
                // Remove all buttons from the cloned row
                var buttons = newRow.querySelectorAll("button");
                buttons.forEach(function(button) {
                    button.parentNode.removeChild(button);
                });
                // Add padding to each cell for column spacing
                for (var j = 0; j < newRow.cells.length; j++) {
                    newRow.cells[j].style.padding = "0 30px"; // Adjust the padding as needed
                }
                // Append the cloned row to listDevice1
                listDevice1Body.appendChild(newRow);

                // Add an empty row with the desired height after each row
                if (i < listDeviceBody.rows.length - 1) {
                    var emptyRow = document.createElement("tr");
                    var emptyCell = document.createElement("td");
                    emptyCell.style.height = "20px"; // Adjust the height value as needed
                    emptyRow.appendChild(emptyCell);
                    listDevice1Body.appendChild(emptyRow);
                }
            }

            // Replace the content of listDevice1 with the content of listDevice1Body
            var listDevice1 = document.getElementById("listDevice1");
            listDevice1.innerHTML = listDevice1Body.innerHTML;

            console.log("Smaller table created successfully!");
        }

        // Function to add a new device
        function AddDevice() {
            let list = JSON.parse(localStorage.getItem('Devices')) || [];
            var id = Date.now(); // Generating a new ID for the device
            var type = document.getElementById("type-device").value;
            var name = document.getElementById("name-device").value;
            var folder = document.getElementById("folder").value;
            var location = document.getElementById("location").value; // Get the value of the new location field

            if (type === "choose") {
                alert("Please select a Sensor!");
                return false;
            }
            if (!name || name === "choose") {
                alert("Operation Mode cannot be empty!");
                return false;
            }

            if (name === "const On" || name === "const Off") {
                folder = "0";  // Set default value for folder if "const On" or "const Off" is selected
                location = "0";  // Set default value for location if "const On" or "const Off" is selected
            } else {
                if (!folder || isNaN(folder)) {  // isNaN function checks if the input is not a number
                    alert("Please enter time in milliseconds using numeric values only!");
                    return false;
                }
                if (!location || isNaN(location)) {  // isNaN function checks if the input is not a number
                    alert("Please enter delay in milliseconds using numeric values only!");
                    return false;
                }
            }

            var device = {
                "id": id,
                "type": type,
                "name": name,
                "folder": folder,
                "location": location // Add the location property
            };
            list.push(device);
            localStorage.setItem('Devices', JSON.stringify(list));
            alert("Device added successfully!");
            LoadListDevice(); // Refresh the list
        }

        // Function to delete a device
        function DeleteDevice(id) {
            let list = JSON.parse(localStorage.getItem('Devices')) || [];
            if (confirm("You definitely want to delete!")) {
                var index = list.findIndex(x => x.id == id);
                if (index >= 0) {
                    list.splice(index, 1);
                }
                localStorage.setItem('Devices', JSON.stringify(list));
                alert('Deleted successfully');
                LoadListDevice();
            }
        }

        // Global variable to keep track of the currently editing device's ID
        var currentlyEditingId = null;

        // Function to save device changes
        function SaveDeviceChanges() {
            if (currentlyEditingId === null) {
                alert("No device selected for editing!");
                return;
            }

            let list = JSON.parse(localStorage.getItem('Devices'));
            let deviceIndex = list.findIndex(x => x.id === currentlyEditingId);
            if (deviceIndex !== -1) {
                let device = list[deviceIndex];
                device.name = document.getElementById('name-device').value;
                device.folder = document.getElementById('folder').value;
                device.type = document.getElementById('type-device').value;
                device.location = document.getElementById('location').value;

                if (device.name === "const On" || device.name === "const Off") {
                    device.folder = "0";  // Set default value for folder if "const On" or "const Off" is selected
                    device.location = "0";  // Set default value for location if "const On" or "const Off" is selected
                }

                localStorage.setItem('Devices', JSON.stringify(list));
                alert("Device updated successfully!");
                LoadListDevice(); // Refresh the list
            } else {
                alert("Device not found!");
            }
        }

        // Function to move device up in the list
        function moveDeviceUp(deviceId) {
            let list = JSON.parse(localStorage.getItem('Devices'));
            let index = list.findIndex(x => x.id === deviceId);
            if (index > 0) { // Check if it's not the first item
                [list[index], list[index - 1]] = [list[index - 1], list[index]]; // Swap with the above item
                localStorage.setItem('Devices', JSON.stringify(list));
                LoadListDevice(); // Reload the list
            }
        }

        // Function to move device down in the list
        function moveDeviceDown(deviceId) {
            let list = JSON.parse(localStorage.getItem('Devices'));
            let index = list.findIndex(x => x.id === deviceId);
            if (index < list.length - 1) { // Check if it's not the last item
                [list[index], list[index + 1]] = [list[index + 1], list[index]]; // Swap with the below item
                localStorage.setItem('Devices', JSON.stringify(list));
                LoadListDevice(); // Reload the list
            }
        }

        // Load the device list when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', LoadListDevice);
    </script>
    <!-- Main JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let chartInstance;

            function createChart(data) {
                const ctx = document.getElementById('myChart').getContext('2d');

                if (chartInstance) {
                    chartInstance.destroy();
                }

                chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Sample Data',
                            data: data.values,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Example data loading
            fetch('data.json')
                .then(response => response.json())
                .then(data => {
                    createChart(data);
                })
                .catch(error => console.error('Error loading data:', error));

            // Firebase Database example usage
            const database = firebase.database();
            const tempRef = database.ref('temperature');

            tempRef.on('value', (snapshot) => {
                const tempData = snapshot.val();
                console.log('Temperature data:', tempData);
                // Update your UI with tempData
            });


    </script>
<script>

        function updateActiveConnections() {
            fetch('/active_connections')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('activeConnections').innerText = data.active_connections;
                });
        }

        setInterval(updateActiveConnections, 1000); // Update every second

</script>


<script>
    function updateBoxStatus() {
        fetch('/box_status')
            .then(response => response.json())
            .then(data => {
                const status = data.box_status;
                const statusElement = document.getElementById('boxStatus');

                statusElement.innerText = status;

                if (status === 'Open') {
                    statusElement.style.color = 'var(--green)';
                } else {
                    statusElement.style.color = 'var(--red)';
                }
            })
            .catch(error => {
                console.error('Error fetching box status:', error);
            });
    }

    // Initial call to set the status on page load
    updateBoxStatus();
    
    // Update the status whenever an interrupt occurs
    setInterval(updateBoxStatus, 1000); // Update every second
</script>


<script>
function toggleDirection(sensorName, direction) {
    // Reset button colors
    $('#forwardButton_' + sensorName + ', #reverseButton_' + sensorName).css('background-color', 'var(--darkgray)');
    
    // Set the background color of the clicked button to dark blue
    if (direction === 'forward') {
        $("#forwardButton_" + sensorName).css("background-color", "var(--darkblue)");
    } else if (direction === 'reverse') {
        $("#reverseButton_" + sensorName).css("background-color", "var(--darkblue)");
    }
}
</script>
<script>
function sendAllTasks() {
    let list = JSON.parse(localStorage.getItem('Devices')) || [];
    console.log('Sending tasks:', list); // Debugging line to see what is being sent
    
    // Check if the list is empty
    if (list.length === 0) {
        console.log('No tasks to send');
        alert('No tasks to send');
        return; // Exit the function early since there's nothing to send
    }
    
    $.ajax({
        url: '/sendTasks', // Make sure this is the correct endpoint
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ devices: list }), // Wrapping the list in an object if the server expects it
        success: function(response) {
            console.log('Tasks sent successfully:', response);
            alert('Tasks sent successfully!');
        },
        error: function(xhr, status, error) {
            console.error('Failed to send tasks:', error);
            alert('Error sending tasks. Please check the console for more details.');
            // More detailed debugging information
            console.error('XHR Object:', xhr);
            console.error('Status:', status);
            console.error('Error:', error);
        }
    });
}
function sendWashCommand() {
    const washCommand = {
        devices: [{
            type: "Wash",
            name: "On",
            folder: "1",
            location: "1"
        }]
    };
    
    $.ajax({
        url: '/sendTasks',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(washCommand),
        success: function(response) {
            console.log('Wash command sent successfully:', response);
            alert('Wash command sent successfully!');
        },
        error: function(xhr, status, error) {
            console.error('Failed to send wash command:', error);
            alert('Error sending wash command. Please check the console for more details.');
            console.error('XHR Object:', xhr);
            console.error('Status:', status);
            console.error('Error:', error);
        }
    });
}

</script>


<script>
function toggleSensor(sensorName, checked) {
    var state = checked ? 'On' : 'Off';  // Determine state based on checkbox
    var direction = ''; // Default direction
    
    // Check if the sensorName is Pump1, Pump2, or Pump3
    if (sensorName === 'Pump1' || sensorName === 'Pump2') {
        // Get direction based on which button is clicked
        if ($("#forwardButton_" + sensorName).css("background-color") === "rgb(44, 53, 221)") {
            direction = 'Forward';
        } else if ($("#reverseButton_" + sensorName).css("background-color") === "rgb(44, 53, 221)") {
            direction = 'Reverse';
        }
    }
      if (sensorName === 'Pump3' || sensorName === 'Pump4' )
      {
                  direction = 'Forward';
                  }
    
    $.ajax({
        url: '/toggleSensor',
        method: 'GET',
        data: { sensorName: sensorName, state: state, direction: direction }, // Send sensor name, state, and direction
        success: function(response) {
            console.log('Response:', response);  // Log server response for debugging
            
            // Change card name color based on response
            if (response === 'Sensor toggled') {
                var cardNameColor = checked ? 'var(--green)' : 'var(--white)';
                $('.card[data-field="' + sensorName + '"] .card-name').css('color', cardNameColor);
            }
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
}
</script>
<script>
function toggleSwitch(id, event) {
    if (!event || event.target.tagName !== 'BUTTON') {
        var checkbox = document.getElementById(id);
        checkbox.checked = !checkbox.checked;
        var field = checkbox.closest('.card').getAttribute('data-field');
        toggleSensor(field, checkbox.checked);
    }
}
</script>





    <script src="js/main.js" defer></script>
<style>
:root {
    --blue: #2C35DD;
    --white: #FFFFFF;
    --grey: #888888;
    --black1: #222;
    --black2: #999;
        --green: #47A025; 
--red:#FF0000;
    --light-blue: #ffffff;
    --shadow: rgba(0, 0, 0, 0.15);
    --card-hover: rgba(40, 123, 255, 0.1);
 --darkgray:#4B4B4B;
 --darkblue:#2C35DD;
    --background-dark: #121212;
    --sidebar-background: #1E1E1E;
    --sidebar-active:#878787;
    --text-primary-dark: #E0E0E0;
    --text-secondary-dark: #B0B0B0;
    --accent-dark: #BB86FC;
    --card-background-dark: #2C2C2C;
    --card-border-dark: #3A3A3A;
    --button-background-dark: #287bff;
    --button-text-dark: #FFFFFF;
    --chart-background-dark: #2A2A2A;
    --chart-line-od1: #4CAF50;
    --chart-line-od2: #FF5722;
    --header-background-dark: #1A1A1A;
    --input-field-background-dark: #1E1E1E;
    --input-field-border-dark: #444444;
    --temperature-data-background-dark: #2C2C2C;
    --graph-axis-dark: #757575;
    --status-bar-dark: #FF5252;

--hover:#1A1B1C;
}

</style>
</head>

<body>
    <div class="wrapper">
        <div class="menu-bar">
            <ul>
                <li>
                
           <a href="#">
                        <span class="icon"><img src="icon/user.png" alt="User Icon" style="width: 28px; height: 28px;"></span>
                        <span class="title">Ben Berni & Moran Tsoran</span>
                    </a>
                </li>
                <li >
                    <a href="#tong-quan">
                                            <span class="icon"><img src="icon/home.png" alt="DashBoard Icon" style="width: 28px; height: 28px;"></span>
                        <span class="title">Dash Board (Simulation)</span>
                    </a>
                </li>
                <li>
                    <a href="#thiet-bi">
                                                                <span class="icon"><img src="icon/task.png" alt="task Icon" style="width: 28px; height: 28px;"></span>
                        <span class="title">Task Editor (Simulation)</span>
                    </a>
                </li>
<li id="menu-set-auto">
    <a href="#set-auto">
        <span class="icon"><img src="icon/setting.png" alt="setting Icon" style="width: 28px; height: 28px;"></span>
        <span class="title">Setting (Simulation)</span>
    </a>
</li>

                <li class="active">
                    <a href="#information">
                                                                                    <span class="icon"><img src="icon/about.png" alt="about Icon" style="width: 28px; height: 28px;"></span>
                        <span class="title">Project Overview</span>
                    </a>
              </li>
            </ul>
        </div>
        
<div class="main">
    <div class="topbar">
        <div class="toggle">
            <span class="icon"><img src="icon/menu.png" alt="menu Icon" style="width: 34px; height: 34px;"></span>
        </div>
<div class="box-status">
    Box Status: <span id="boxStatus" style="color: var(--red);">undefined</span>
</div>



        <div class="setting" onclick="navigateToSetAuto()">
            <span class="icon"><img src="icon/setting.png" alt="setting Icon" style="width: 34px; height: 34px;"></span>
        </div>
    </div>
            <div class="tab-content">
            
            
                <div class="content-item" id="tong-quan">
                <div class="dashboard-container">
    <div class="graphs-container">

        <div class="graph-container graph1">
                <div class="container-od ">
<h2 class="text-widget" style="color: #fff; font-size: 24px;">OD 600 (Simulation)</h2>
<p style="color: #bbb; font-size: 16px; text-align: center;">
    This simulation shows the growth of two bacteria over time, with OD1 starting at 0.1 and increasing, and OD2 starting at 0.4 and increasing. The growth increments randomly between 0.01 and 0.09 every 2 seconds.
</p>
<button class="btn-form" style="width: 120px; margin-left: 60px; font-size: 14px" onclick="downloadExcel()">Download OD Data</button>

<canvas id="myChart" width="auto" height="auto" ></canvas>
    </div>
                <div class="container-control ">
<h2 class="text-widget" style="color: #fff; font-size: 24px; ">Control Sensor</h2>

            <div class="card-box">
    <div class="card" data-field="Heating" onclick="toggleSwitch('toggle_Heating')">
     <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="card-name" style="color:var(--white); padding-bottom: 18px;">Heating</div>
            <div class="icon-box" >
            <img src="icon/Heating.png" alt="Heating Icon" >
        </div>
                </div>
        <input type="checkbox" id="toggle_Heating" style="display:none;">
    </div>



  


    <div class="card" data-field="Fan" onclick="toggleSwitch('toggle_FAN')">
     <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="card-name" style="color:var(--white); padding-bottom: 18px;">Fan</div>
                    <div class="icon-box">
            <img src="icon/fan.png" alt="Fan Icon" >
        </div>
                        </div>
        <input type="checkbox" id="toggle_FAN" style="display:none;">
    </div>
 <div class="card" data-field="Pump3" onclick="toggleSwitch('toggle_pump3')">
     <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="card-name" style="color:var(--white); padding-bottom: 18px;">Vibrate 1</div>
                    <div class="icon-box" >
            <img src="icon/shake.png" alt="Pump Icon">
 </div>
                </div>
        <input type="checkbox" id="toggle_pump3" style="display:none;">
    </div>

    <div class="card" data-field="Pump4" onclick="toggleSwitch('toggle_pump4')">
     <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="card-name" style="color:var(--white); padding-bottom: 18px;">Vibrate 2</div>
            <div class="icon-box" >
            <img src="icon/shake.png" alt="Pump Icon">
        </div>
                </div>
        <input type="checkbox" id="toggle_pump4" style="display:none;">
    </div>
  


    
    
    


    <div class="card" data-field="Led1" onclick="toggleSwitch('toggle_LED1')">
    <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="card-name" style="color:var(--white); padding-bottom: 18px;">Led 1</div>
                    <div class="icon-box">
            <img src="icon/led.png" alt="LED Icon">
        </div>
                </div>
        <input type="checkbox" id="toggle_LED1" style="display:none;">
    </div>

<div class="card" data-field="Led2" onclick="toggleSwitch('toggle_LED2', event)">
    <div style="display: flex; flex-direction: column; align-items: center;">
        <div class="card-name" style="color:var(--white); padding-bottom: 18px;">Led 2</div>
        <div class="icon-box">
            <img src="icon/led.png" alt="LED Icon" ">
        </div>
    </div>
    <input type="checkbox" id="toggle_LED2" style="display:none;">
</div>

    
    
<div class="card" data-field="Pump1" onclick="toggleSwitch('toggle_pump1', event)">
    <div>
        <div class="icon-box"></div>
        <div class="card-name" style="color:var(--white)">Pump 1</div>
        <img src="icon/pump.png" alt="Pump Icon">
    </div>
    <div style="display: flex; flex-direction: row; justify-content: center; align-items: center; margin-top: 10px;">
            <button class="btn-form2" id="reverseButton_Pump1" onclick="toggleDirection('Pump1', 'reverse'); event.stopPropagation();"style= "margin-right: 5px;background-color: var(--darkgray);">&#8595;</button>
        <button class="btn-form2" id="forwardButton_Pump1" onclick="toggleDirection('Pump1', 'forward'); event.stopPropagation();" style= "background-color:  var(--darkblue);">&#8593;</button>

    </div>
    <input type="checkbox" id="toggle_pump1" style="display:none;">
</div>

<div class="card" data-field="Pump2" onclick="toggleSwitch('toggle_pump2', event)">
    <div>
        <div class="icon-box"></div>
        <div class="card-name" style="color:var(--white)">Pump 2</div>
        <img src="icon/pump.png" alt="Pump Icon">
    </div>
    <div style="display: flex; flex-direction: row; justify-content: center; align-items: center; margin-top: 10px;">
            <button class="btn-form2" id="reverseButton_Pump2" onclick="toggleDirection('Pump2', 'reverse'); event.stopPropagation();"style= "margin-right: 5px;background-color: var(--darkgray);">&#8595;</button>
        <button class="btn-form2" id="forwardButton_Pump2" onclick="toggleDirection('Pump2', 'forward'); event.stopPropagation();" style= "background-color: var(--darkblue);">&#8593;</button>

    </div>
    <input type="checkbox" id="toggle_pump2" style="display:none;">

</div>
</div>
    </div>

        </div>
        <div class="graph-container graph2">

                <div class=" data-recevied">
        <h2 class="text-widget" style="color: #fff; font-size: 24px ;">Received Data</h2>

                       <div class="widgets-row">
            <div class="widget">
                <div class="percent">
                    <svg id="circle3">
                        <circle cx="45" cy="45" r="45"></circle>
                        <circle cx="45" cy="45" r="45"></circle>
                    </svg>
                    <div class="number">
                        <h2 id="adc1">NaN<span></span></h2>
                    </div>
                    <h2 class="text-widget" style="text-align: center;">OD 1</h2>
                </div>
            </div>
            <div class="widget">
                <div class="percent">
                    <svg id="circle4">
                        <circle cx="45" cy="45" r="45"></circle>
                        <circle cx="45" cy="45" r="45"></circle>
                    </svg>
                    <div class="number">
                        <h2 id="adc2">NaN<span></span></h2>
                    </div>
                    <h2 class="text-widget" style="text-align: center;">OD 2</h2>
                </div>
            </div>
                    <div class="widget">
                <div class="percent">
                    <svg id="circle1">
                        <circle cx="45" cy="45" r="45"></circle>
                        <circle cx="45" cy="45" r="45"></circle>
                    </svg>
                    <div class="number">
                        <h2 id="Temp">NaN<span>°C</span></h2>
                    </div>
                    <h2 class="text-widget" style="text-align: center;">Temp</h2>
                </div>
            </div>
            <div class="widget">
                <div class="percent">
                    <svg id="circle2">
                        <circle cx="45" cy="45" r="45"></circle>
                        <circle cx="45" cy="45" r="45"></circle>
                    </svg>
                    <div class="number">
                        <h2 id="Humidity">NaN<span>%</span></h2>
                    </div>
                    <h2 class="text-widget" style="text-align: center;">Humidity</h2>
                </div>
            </div>
        </div>
        </div >
                                    <div class="weather-container">
                    <h2 class="text-widget" style="color: #fff; font-size: 24px;padding-bottom: 11px;">Temperature</h2>
                    <p style="color: #bbb; font-size: 16px; text-align: center;padding-bottom: 10px;">
    This simulation displays the temperature around 25°C with small fluctuations and humidity around 60% with small fluctuations over time.
</p>
<button class="btn-form" style="width: 124px; margin-left: 40px;   font-size: 14px; " onclick="downloadTempExcel()">Download Temp Data</button>
        
            <canvas id="myChart3" width="auto" height="auto" ></canvas>
            
        </div>
         
                            <div class="task-container">
    <div class="card-header">
                                                            <h2 class="text-widget" style="color: #fff; font-size: 26px;padding-bottom: 16px;">System Task Integrate</h2>
                    <h3>Total Task Number : <span id="tongsosp1">0</span></h3>
                </div>
                            <table>

        <tr style="border-bottom: 1px solid #ccc;margin-bottom: 20px;">

                                            <th style="text-align: right;padding-right: 27px;">      #</th> <!-- Counter header -->

                                        <th style="text-align: center;padding-left: 12px;"> Sensor</th>
                                        <th style="text-align: center;padding-right: 8px; ">Command</th>
                                        <th style="text-align: left; padding-left: 2px;">Time On</th>
                                        <th style="text-align: left; padding-right: 24px;">Delay </th> <!-- New Location header -->


                                    </tr >

                    <tbody id="listDevice1">
                        <!-- Your table rows here -->
                        <tr>
                    

            <td colspan="15" style="text-align: center;">No Task Waiting Add Task</td>

                        </tr>
                        <!-- Add more rows as needed -->
                    </tbody>
                </table>
                <div class="card-footer ">
                    <h2 style="color: var(--green);">Send All The Task</h2>
                    <div style="display: flex; justify-content: flex-start;">
                        <button class="btn-formgreen" onclick="sendAllTasks()" style="color: white; padding: 5px 10px; font-size: 14px;">Run</button>
                    </div>
                </div>
            </div>
        </div>
             </div>            </div>
                                  </div>                 </div>             
<div class="content-item" id="thiet-bi">
    <div class="colum12">
        <div class="cot1">
            <div class="card-header">
<h2 style="color: var(--white);">Choose Sensor</h2>
            </div>
            <form>
                <div class="title-input">
                    <h4>Sensor to Add</h4>
                </div>
                <div class="input-box">
                    <select name="type-device" id="type-device" onchange="toggleSettingsVisibility(this.value)">
                        <option value="choose">-Choose Sensor-</option>
                        <option value="Pump1">Pump 1</option>
                        <option value="Pump2">Pump 2</option>
                        <option value="Vibration1">Vibration 1</option>
                        <option value="Vibration2">Vibration 2</option>
                        <option value="Heating">Heating</option>
                        <option value="Fan">Fan</option>
                        <option value="ADC1">Wait For Adc 1</option>
                        <option value="ADC2">Wait For Adc 2</option>
                    </select>
                </div>
                <div class="hidden" id="settings">
                    <div class="title-input" id="operation-mode-title">
                        <h4>Operation Mode</h4>
                    </div>
                    <div class="input-box" id="operation-mode-input">
                        <select name="name-device" id="name-device" onchange="toggleTimeAndDelay(this.value)">
                            <option value="choose">-Choose An Operation Mode-</option>
                        </select>
                    </div>
                    <div class="title-input" id="working-time-title">
                        <h4>Working Time</h4>
                    </div>
                    <div class="input-box" id="working-time-input">
                        <input type="text" id="folder" placeholder="Enter Time That The Task Should Work in Millisecond">
                    </div>
                    <div class="title-input" id="delay-task-title">
                        <h4>Delay Next Task</h4>
                    </div>
                    <div class="input-box" id="delay-task-input">
                        <input type="text" id="location" placeholder="Enter Delay To The Next Task Run" oninput="updateDelayValue()">
                    </div>
                </div>
          <div class="list-btn"style="padding-left:50px">
    <button class="btn-form" type="button" onclick="AddDevice()" style="margin-left: auto;">Add Device</button>
    <button class="btn-form" type="button" onclick="SaveDeviceChanges()" style="margin-left: auto;">Save Changes</button>

</div>

            </form>
  <p style="margin-top: 20px; color: #fff; font-size: 18px; text-align: center; max-width: 600px; padding: 10px; margin-left: auto; margin-right: auto;">
                Choose a sensor to set tasks and schedules. Manage multiple sensors and set OD600 values for automatic actions.
            </p>
    </div>

                        <div class="cot2">
                            <div class="card-header">
                                <h2 style="color: var(--white);">System Task Integrate</h2>
                                <h4>Total : <span id="tongsosp">0</span></h4>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                            <td style="text-align: right; padding-left: 55px;">      #</td> <!-- Counter header -->

                                        <td style="text-align: right; padding-left: 89px;">Sensor</td>
                                        <td style="text-align: right; padding-left: 68px;">Command</td>
                                        <td style="text-align: right; padding-right: 180px;">Time On</td>
                                        <td >Delay </td> <!-- New Location header -->
<td >Edit Or Delete</td>







                                    </tr>
                                </thead>
                                <tbody id="listDevice">
                                  


                                </tbody>
                            </table>
<div class="card-header">
    <h2 style="color: var(--green);">Send All The Task</h2>
    <div style="display: flex; justify-content: flex-start; width: 50%;">
        <button class="btn-formgreen" onclick="sendAllTasks()" style=" color: white;">Run</button>
    </div>
</div>


                        </div>
                        
                    </div>
                </div>
<div class="content-item" id="set-auto" style="text-align: center;padding-top:20px;">
    <div class="lds-grid">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
    <h2 class="text-widget" >Updating...</h2>

    <!-- New section for setting values -->
    
    <div style="background: #2C2C2C; box-shadow: 0 7px 25px rgba(0, 0, 0, 0.08); border-radius: 20px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top: 20px; width: 60%; margin-left: auto; margin-right: auto;">
    

<!-- Existing content before "Set Values" section --><h2 class="text-widget" style="color: #fff; font-weight: 600; letter-spacing: 1px; margin-bottom: 20px; font-size: 26px;">Adjust Values</h2>
<p style="color: #bbb; text-align: center; font-size: 16px; margin-bottom: 20px; max-width: 80%; line-height: 1.5;">
    Adjust the speeds for Pump 1 and Pump 2, and the vibrations for the tubes. Set V01 and V02 for the OD600 formula, which measures light absorption to find optical density. Use -1 to show ADC values for calibration.
</p>


<form id="setValuesForm">
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 15px;">
        <label for="pwm1" style="font-weight: 600; color: var(--white); margin-bottom: 5px;">Pump 1 & 2 Speed:</label>
        <input type="text" id="pwm1" name="pwm1" placeholder="Enter Pump 1 & 2 speed value" 
               style="padding: 10px; border: 1px solid #ccc; border-radius: 6px; color:#fff; background-color:#222; text-align: center;">
    </div>
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 15px;">
        <label for="pwm2" style="font-weight: 600; color: var(--white); margin-bottom: 5px;">Vibration Speed 1 (Tube 1):</label>
        <input type="text" id="pwm2" name="pwm2" placeholder="Enter Vibration Speed 1 value" 
               style="padding: 10px; border: 1px solid #ccc; border-radius: 6px; color: #fff; background-color: #222; text-align: center;">
    </div>
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 15px;">
        <label for="pwm3" style="font-weight: 600; color: var(--white); margin-bottom: 5px;">Vibration Speed 2 (Tube 2):</label>
        <input type="text" id="pwm3" name="pwm3" placeholder="Enter Vibration Speed 2 value" 
               style="padding: 10px; border: 1px solid #ccc; border-radius: 6px; color: #fff; background-color: #222; text-align: center;">
    </div>
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 15px;">
        <label for="v01" style="font-weight: 600; color: var(--white); margin-bottom: 5px;">V01 Value (OD600 Check):</label>
        <input type="text" id="v01" name="v01" placeholder="Enter V01 value" 
               style="padding: 10px; border: 1px solid #ccc; border-radius: 6px; color: #fff; background-color: #222; text-align: center;">
    </div>
    <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 15px;">
        <label for="v02" style="font-weight: 600; color: var(--white); margin-bottom: 5px;">V02 Value (OD600 Check):</label>
        <input type="text" id="v02" name="v02" placeholder="Enter V02 value" 
               style="padding: 10px; border: 1px solid #ccc; border-radius: 6px; color: #fff; background-color: #222; text-align: center;">
    </div>
    <div class="list-btn" style="display: flex; justify-content: center; padding-top: 20px;">
        <button type="button" class="btn-form" onclick="saveSettings()" style="color: var(--white); min-width: 90px; height: 30px; border: none; border-radius: 6px; transition: all 0.3s ease; cursor: pointer; font-size: 14px;">Save</button>
    </div>





<!-- "Start Automatic Wash System" section placed after the "Save" button -->
<h2 class="text-widget" style="color: #fff; font-weight: 600; letter-spacing: 1px; margin-top: 30px; padding-bottom: 20px; font-size: 24px;">Start Automatic Wash System</h2>

<p style="color: #bbb; text-align: center; font-size: 16px; margin-bottom: 30px; max-width: 100%; line-height: 1.5;padding-top: 2px;">
    During the wash, Pump 1 and Pump 2 pump detergent from Pump 3 for 60 seconds and then stop.
</p>

<button type="button" class="btn-form" onclick="sendWashCommand()" style="color: var(--white); border: none; border-radius: 6px; transition: all 0.3s ease; cursor: pointer; font-size: 14px; margin-top: 2px;">Start Wash</button>
<p style="padding-top:50px;">
    
</p>
</form>
    </div>
    </div>
<div class="content-item" id="information">

<div style="background: #2C2C2C; box-shadow: 0 7px 25px rgba(0, 0, 0, 0.08); border-radius: 20px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top: 20px; width: 70%; margin-left: auto; margin-right: auto;">
    <div class="card-header">
        <h2 style="color: #fff; font-weight: 600; letter-spacing: 1px; margin-bottom: 20px; font-size: 26px;">Project Overview</h2>
    </div>
    <p style="margin-top: 20px; color: #fff; font-size: 18px; line-height: 1.6; text-align: center;">
        <strong style="color:#47A025;font-size: 22px;">Microfluidic Bacterial Analysis System</strong>
        <br><br>
        The system detects bacterial growth using OD600 sensors, provides real-time monitoring, and transfers samples to a mating chamber.<br> It integrates an STM32F446RE microcontroller with FreeRTOS for multitasking and an ESP32 module for hosting the monitoring website.
    </p>
    <div style="text-align: left; width: 100%; max-width: 800px; margin-top: 20px;">
        <strong style="color: #47A025;font-size: 18px;">Product Capabilities and System Components:</strong>
        <ul style="list-style-type: none; padding-left: 10px; line-height: 1.5;">
            <li>1. <strong>OD600 Sensor Monitoring:</strong> Tracks bacterial growth using OD600 sensors in tubes and chambers.</li>
            <li>2. <strong>Temp Control:</strong> Maintains optimal conditions with temperature sensors, heating surfaces, heating plates, and fans.</li>
            <li>3. <strong>Pump Control:</strong> Automates culture transfer, air insertion, mixing, and cleaning.</li>
             <li>4. <strong>IR Sensor:</strong> Stops OD readings if the box is opened to prevent light interference.</li>
            <li>5. <strong>Web-Based Dashboard:</strong> User-friendly interface hosted on an ESP32 for real-time data monitoring.</li>
            <li>6. <strong>Microcontroller (STM32F446RE):</strong> Controls sensors and actuators, running FreeRTOS for multitasking.</li>
        </ul>
        <br>
        <strong style="color: #47A025;font-size: 18px; ">System Scheme:</strong>
        <ul style="list-style-type: none; padding-left: 10px; line-height: 1.5;">
        <div style="margin-top: 5px; text-align: center;">
              <img 
    src="" 
    alt="System Diagram (In Progress)" 
    class="small-img" 
    onclick="showImage(this)" 
    style="height: 300px; width: 600px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); margin: 10px;" 
    title="Image is currently being built in Figma">

            </div>
            <li>- <strong>Microcontroller:</strong> STM32F446RE for control.</li>
            <li>- <strong>Power Supply:</strong> USB for STM32/ESP32, 230V to 5V/12V adapters.</li>
            <li>- <strong>Sensors and Actuators:</strong> Synchronized with the microcontroller.</li>
        </ul>
        <br>
        <div style="text-align: left; width: 100%; max-width: 800px; margin-top: 20px;">
            <strong style="color: #47A025;font-size: 18px;">System Diagram:</strong>
            <div style="margin-top: 5px; text-align: center;">
                <img src="icon/system_diagram.png" alt="System Diagram" class="small-img" onclick="showImage(this)" style="height: 300px; width: 600px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); margin: 10px;">
            </div>
            <ul style="list-style-type: none; padding-left: 10px; line-height: 1.5;">
                <li>- <strong style="color: #B0B0B0;">Bacterial 1 Tube and Bacterial 2 Tube:</strong> ADC1 and ADC2 read the OD600 measurements from the bacterial cultures.</li>
                <li>- <strong style="color: #B0B0B0;">Mating Tube:</strong> Transfers samples from the bacterial tubes for mating processes.</li>
                <li>- <strong style="color: #B0B0B0;">Temperature Control:</strong> Monitors temperature and uses heating and fan for regulation.</li>
                <li>- <strong style="color: #B0B0B0;">Air Filters:</strong> Pump3 and Pump4 mix filtered air into the system for aerobic conditions.</li>
                <li>- <strong style="color: #B0B0B0;">Pumps:</strong> Pump1 and Pump2 transfer cultures from Bacterial Tubes to the Mating Tube.</li>
            </ul>
        </div>
        <br>
        <strong style="color: #47A025;font-size: 18px;">Website Features:</strong>
        <ul style="list-style-type: none; padding-left: 10px; margin-left: 0;">
            <li style="margin-bottom: 10px; list-style-type: none; margin-left: 0;"><strong style="color: #fff;">DashBoard Simulation:</strong>
                <ul style="list-style-type: none; margin-left: 10px; line-height: 1.5;">
                    <li>- <strong style="color: #B0B0B0;">Data Monitoring:</strong> Real-time graphs for OD600 and temperature values.</li>
                    <li>- <strong style="color: #B0B0B0;">Received Data:</strong> Displays OD1, OD2, Temperature, and Humidity readings.</li>
                    <li>- <strong style="color: #B0B0B0;">Control Sensor:</strong> Provides controls for Heating, Fan, Vibrate, LED, and Pump operations.</li>
                    <li>- <strong style="color: #B0B0B0;">System Task Integrate:</strong> Allows scheduling and running tasks for sensors and actuators.</li>
                </ul>
            </li>
            <li style="margin-bottom: 10px; list-style-type: none; margin-left: 0;"><strong style="color: #fff;">Task Editor Simulation:</strong>
                <ul style="list-style-type: none; margin-left: 10px; line-height: 1.5;">
                    <li>- <strong style="color: #B0B0B0;">Choose Sensor:</strong> Select a sensor to set tasks and schedules.</li>
                    <li>- <strong style="color: #B0B0B0;">Manage Tasks:</strong> Add, edit, and delete tasks for various sensors and actuators.</li>
                    <li>- <strong style="color: #B0B0B0;">Send All Tasks:</strong> Submit all configured tasks to the system for execution.</li>
                </ul>
            </li>
            <li style="margin-bottom: 10px; list-style-type: none; margin-left: 0;"><strong style="color: #fff;">Settings Simulation:</strong>
                <ul style="list-style-type: none; margin-left: 10px; line-height: 1.5;">
                    <li>- <strong style="color: #B0B0B0;">Adjust Values:</strong> Set the speeds for Pump 1 and Pump 2, and the vibrations for the tubes. Configure V01 and V02 for the OD600 formula, which measures light absorption to find optical density. Use -1 to display ADC values for calibration.</li>
                    <li>- <strong style="color: #B0B0B0;">Start Automatic Wash:</strong> During the wash, Pump 1 and Pump 2 detergent from Pump 3 for 60 seconds and then stop.</li>
                </ul>
            </li>
        </ul>

<div style="text-align: left; width: 100%; max-width: 800px; margin-top: 20px;">
    <strong style="color: #47A025;font-size: 18px;">Software and Firmware:</strong>
    <ul style="list-style-type: none; padding-left: 20px; line-height: 1.5;">

        <li>- <strong>Firmware:</strong> The STM32F446RE, programmed in C using STM32CubeIDE, runs FreeRTOS for real-time tasks.</li>
        <li>- <strong>Real-Time Website:</strong> Hosted on the ESP32, running Arduino code. HTML, CSS, and JavaScript are burned to flash memory using SPIFFS and the ESP32 Sketch Data Upload tool.</li>

        <li>- <strong>Data Communication:</strong> Reliable UART communication between STM32F446RE and ESP32 ensures accurate data transfer.</li>
    </ul>
</div>
<br>

        <p style="margin-top: 20px; color: #fff; font-size: 18px; line-height: 1.6; text-align: center;">
            <strong style="color:#47A025;font-size: 22px;">Pictures & Videos</strong>
        </p>
        <div style="margin-top: 20px; text-align: center;">
            <div style="display: flex; justify-content: center;">
                <img src="icon/picture1.png" alt="Microfluidic Bacterial Analysis System - Image 1" class="small-img" onclick="showImage(this)" style="height: 200px; width: 200px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); margin: 10px;">
                <img src="icon/picture2.png" alt="Microfluidic Bacterial Analysis System - Image 2" class="small-img" onclick="showImage(this)" style="height: 200px; width: 200px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); margin: 10px;">
            </div>

            <!-- Modal to display the enlarged image -->
            <div id="imageModal" class="modal">
                <span class="close" onclick="closeModal()">&times;</span>
                <img class="modal-content" id="modalImg">
            </div>
        </div>
    </div>
</div>

<script>
    function showImage(img) {
        var modal = document.getElementById("imageModal");
        var modalImg = document.getElementById("modalImg");
        modal.style.display = "block";
        modalImg.src = img.src;
    }

    function closeModal() {
        var modal = document.getElementById("imageModal");
        modal.style.display = "none";
    }
</script>


    <script>
function showImage(img) {
    var modal = document.getElementById("imageModal");
    var modalImg = document.getElementById("modalImg");
    modal.style.display = "block";
    modalImg.src = img.src;
}

function closeModal() {
    var modal = document.getElementById("imageModal");
    modal.style.display = "none";
}
</script>

    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
    <canvas id="myChart"></canvas>
    <link rel="stylesheet" href="css/style.css">



    <script defer src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/10.0.0/firebase-database-compat.js"></script>
    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            LoadListDevice();
        });
    </script>
    
    <script>
        //show content
        $(document).ready(function () {
            $('.content-item').hide();
            $('.content-item:first-child').fadeIn();
            $('.menu-bar ul li').click(function () {
                $('.menu-bar ul li').removeClass('active');
                $(this).addClass('active');
                let id_content = $(this).children('a').attr('href');
                $('.content-item').hide();
                $(id_content).fadeIn();
                return false;
            });
        });
        // $('.menu-bar').hover(function(){
        //     $('.menu-bar ul li').removeClass('active');
        // }, function(){
        //     $('.menu-bar ul li').addClass('active');
        // });
        //menu toggle
        let toggle = document.querySelector('.toggle');
        let menu = document.querySelector('.menu-bar');
        let main = document.querySelector('.main');

        toggle.onclick = function () {
            menu.classList.toggle('active');
            main.classList.toggle('active');
        }


        // ========================
    </script>



<script>
function toggleSettingsVisibility(sensor) {
    const settingsSection = document.getElementById('settings');
    const operationModeSelect = document.getElementById('name-device');
    const workingTimeTitle = document.getElementById('working-time-title');
    const delayTaskTitle = document.getElementById('delay-task-title');
    const adc1DelayText = document.getElementById('adc1-delay-text');
    const adc2DelayText = document.getElementById('adc2-delay-text');

    if (sensor === "choose") {
        settingsSection.classList.add('hidden');
        adc1DelayText.textContent = "Val: "; // Reset the text content
        adc2DelayText.textContent = "Val: "; // Reset the text content
        return;
    }

    const forwardReverseOptions = `
        <option value="Forward">Forward</option>
        <option value="Reverse">Reverse</option>
    `;
    const onOffOptions = `
        <option value="On">On</option>
        <option value="Off">Off</option>
        <option value="const On">const On</option>
        <option value="const Off">const Off</option>
    `;

    if (sensor === "Pump1" || sensor === "Pump2" || sensor === "Pump3" || sensor === "Pump4") {
        operationModeSelect.innerHTML = forwardReverseOptions;
        workingTimeTitle.querySelector('h4').innerText = "Pump Working Time";
        delayTaskTitle.querySelector('h4').innerText = "Pump Delay Next Task";
    } else {
        operationModeSelect.innerHTML = onOffOptions;
        switch (sensor) {
            case "Heating":
                workingTimeTitle.querySelector('h4').innerText = "Heating Time";
                delayTaskTitle.querySelector('h4').innerText = "Heating Delay Time";
                break;
            case "Fan":
                workingTimeTitle.querySelector('h4').innerText = "Fan Running Time";
                delayTaskTitle.querySelector('h4').innerText = "Fan Delay Time";
                break;
            case "ADC1":
                workingTimeTitle.querySelector('h4').innerText = "ADC1: Duration pump1 operates upon receiving the correct value.";
                delayTaskTitle.querySelector('h4').innerText = "ADC1: Threshold value to initiate pump1.";
                break;
            case "ADC2":
                workingTimeTitle.querySelector('h4').innerText = "ADC2: Duration pump2 operates upon receiving the correct value.";
                delayTaskTitle.querySelector('h4').innerText = "ADC2: Threshold value to initiate pump2.";
                break;
            default:
                workingTimeTitle.querySelector('h4').innerText = "Working Time";
                delayTaskTitle.querySelector('h4').innerText = "Delay Next Task";
                break;
        }
    }

    settingsSection.classList.remove('hidden');
    toggleTimeAndDelay(operationModeSelect.value);

    // Show the delay texts if both ADC1 and ADC2 are present
    if (sensor === "ADC1") {
        adc1DelayText.classList.remove('hidden');
    } else if (sensor === "ADC2") {
        adc2DelayText.classList.remove('hidden');
    }
}

function toggleTimeAndDelay(mode) {
    const workingTimeInput = document.getElementById('folder');
    const delayTaskInput = document.getElementById('location');
    const workingTimeTitle = document.getElementById('working-time-title');
    const delayTaskTitle = document.getElementById('delay-task-title');

    if (mode === "const On" || mode === "const Off") {
        workingTimeInput.value = "0"; // Set value to 0
        delayTaskInput.value = "0"; // Set value to 0
        workingTimeInput.classList.add('hidden');
        delayTaskInput.classList.add('hidden');
        workingTimeTitle.classList.add('hidden');
        delayTaskTitle.classList.add('hidden');
    } else {
        workingTimeInput.classList.remove('hidden');
        delayTaskInput.classList.remove('hidden');
        workingTimeTitle.classList.remove('hidden');
        delayTaskTitle.classList.remove('hidden');
    }
}

function updateDelayValue() {
    const delayValue = document.getElementById('location').value;
    const deviceType = document.getElementById('type-device').value;
    const adc1DelayText = document.getElementById('adc1-delay-text');
    const adc2DelayText = document.getElementById('adc2-delay-text');

    if (deviceType === 'ADC1') {
        adc1DelayText.textContent = `Val: ${delayValue}`;
        adc1DelayText.setAttribute("fill", "black");  // Change the text color to black
    } else if (deviceType === 'ADC2') {
        adc2DelayText.textContent = `Val: ${delayValue}`;
        adc2DelayText.setAttribute("fill", "black");  // Change the text color to black
    }
    console.log("SVG Text Content Updated:", deviceType, delayValue);  // Confirm the update
}
</script>


<script>
function EditDevice(id) {
    currentlyEditingId = id; // Set the global variable
    let list = JSON.parse(localStorage.getItem('Devices'));
    let device = list.find(x => x.id === id);
    if (device) {
        document.getElementById('type-device').value = device.type;
        toggleSettingsVisibility(device.type); // Update the form based on the device type
        document.getElementById('name-device').value = device.name;
        document.getElementById('folder').value = device.folder;
        document.getElementById('location').value = device.location;

        // Ensure all settings are visible
        document.getElementById('settings').classList.remove('hidden');
        toggleTimeAndDelay(device.name); // Ensure time and delay are shown/hidden based on operation mode
    }
}
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Example function to update the graph
    function updateGraph(data) {
        var ctx = document.getElementById('myChart').getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Sample Data',
                    data: data.values,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Example data loading
    fetch('path/to/your/data.json')
        .then(response => response.json())
        .then(data => {
            updateGraph(data);
        })
        .catch(error => console.error('Error loading data:', error));
});
</script>
<script>
function toggleSensor(sensorName, checked) {
    var state = checked ? 'On' : 'Off';  // Determine state based on checkbox
    var direction = ''; // Default direction
    
    // Check if the sensorName is Pump1, Pump2, or Pump3
    if (sensorName === 'Pump1' || sensorName === 'Pump2' || sensorName === 'Pump3' || sensorName === 'Pump4') {
        // Get direction based on which button is clicked
        if ($("#forwardButton_" + sensorName).css("background-color") == "rgb(0, 0, 255)") {
            direction = 'Forward';
        } else if ($("#reverseButton_" + sensorName).css("background-color") == "rgb(0, 0, 255)") {
            direction = 'Reverse';
        }
    }
    
    $.ajax({
        url: '/toggleSensor',
        method: 'GET',
        data: { sensorName: sensorName, state: state, direction: direction }, // Send sensor name, state, and direction
        success: function(response) {
            console.log('Response:', response);  // Log server response for debugging
            
            // Change card name color based on response
            if (response === 'Sensor toggled') {
                var cardNameColor = checked ? 'green' : 'red';
                $('.card[data-field="' + sensorName + '"] .card-name').css('color', cardNameColor);
            }
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
}
</script>

<script>
function sendAllTasks() {
    let list = JSON.parse(localStorage.getItem('Devices')) || [];
    console.log('Sending tasks:', list); // Debugging line to see what is being sent
    $.ajax({
        url: '/sendTasks', // Make sure this is the correct endpoint
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ devices: list }), // Wrapping the list in an object if the server expects it
        success: function(response) {
            console.log('Tasks sent successfully:', response);
            alert('Tasks sent successfully!');
        },
        error: function(xhr, status, error) {
            console.error('Failed to send tasks:', error);
            alert('Error sending tasks. Please check the console for more details.');
            // More detailed debugging information
            console.error('XHR Object:', xhr);
            console.error('Status:', status);
            console.error('Error:', error);
        }
    });
}


</script>

<script>
function toggleDirection(sensorName, direction) {
    // Reset button colors
    $('#forwardButton_' + sensorName + ', #reverseButton_' + sensorName).css('background-color', 'gray');
    
    // Set the background color of the clicked button to blue
    if (direction === 'forward') {
        $("#forwardButton_" + sensorName).css("background-color", "blue");
    } else if (direction === 'reverse') {
        $("#reverseButton_" + sensorName).css("background-color", "blue");
    }
}

</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var ctx3 = document.getElementById('myChart3').getContext('2d');

    var data5 = {
        labels: [],
        datasets: [{
            label: 'Temperature',
            data: [],
            borderColor: 'rgba(200, 233, 255, 1)', // Bright Blue
            backgroundColor: 'rgba(255, 233, 255, 0.2)', // Light Blue Background
            borderWidth: 2,
            tension: 0.4
        }]
    };

    var config5 = {
        type: 'line',
        data: data5,
        options: {
            responsive: true,
            maintainAspectRatio: true, // Maintain aspect ratio
            scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 10,
                        color: '#E0E0E0' // Light text color for dark mode
                    },
                    title: {
                        display: true,
                        text: 'Temperature (°C)',
                        color: '#E0E0E0' // Light text color for dark mode
                    },
                    grid: {
                        color: '#3A3A3A' // Grid line color for dark mode
                    }
                },
               x: {
                    ticks: {
                        color: '#E0E0E0' // Light text color for dark mode
                    },
                    title: {
                        display: true,
                        text: 'Time',
                        color: '#E0E0E0' // Light text color for dark mode
                    },
                    grid: {
                        color: '#3A3A3A' // Grid line color for dark mode
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#E0E0E0' // Light text color for dark mode
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.7)', // Dark tooltip background
                    titleColor: '#E0E0E0', // Light text color for tooltip title
                    bodyColor: '#E0E0E0', // Light text color for tooltip body
                    borderColor: '#E0E0E0', // Light border color for tooltip
                    borderWidth: 1
                }
            }
        }
    };
    var myChart3 = new Chart(ctx3, config5);

    function simulateTemperature() {
        var now = new Date().toLocaleTimeString();
        var simulatedTemp = 25 + (Math.random() - 0.5) * 0.5; // Simulated temperature around 25°C with small fluctuations
        var simulatedHumidity = 60 + (Math.random() - 0.5) * 5; // Simulated humidity around 60% with small fluctuations

        // Update the temperature chart
        data5.labels.push(now);
        data5.datasets[0].data.push(simulatedTemp);

        myChart3.update();

        // Update temperature values for Temp and Humidity
        document.getElementById('Temp').innerHTML = `${simulatedTemp.toFixed(1)}°C`;
        document.getElementById('Humidity').innerHTML = `${simulatedHumidity.toFixed(1)}%`;

        // Update SVG circle's stroke-dashoffset based on the temperature values
        const circle1 = document.getElementById('circle1').querySelector('circle:nth-child(2)');
        const circle2 = document.getElementById('circle2').querySelector('circle:nth-child(2)');
        const radius1 = circle1.r.baseVal.value;
        const radius2 = circle2.r.baseVal.value;
        const circumference1 = 2 * Math.PI * radius1;
        const circumference2 = 2 * Math.PI * radius2;
        const offset1 = circumference1 - ((simulatedTemp) / 50) * circumference1;
        const offset2 = circumference2 - ((simulatedHumidity) / 100) * circumference2;
        circle1.style.strokeDasharray = `${circumference1}`;
        circle1.style.strokeDashoffset = `${offset1}`;
        circle2.style.strokeDasharray = `${circumference2}`;
        circle2.style.strokeDashoffset = `${offset2}`;
    }

    simulateTemperature(); // Simulate immediately
    setInterval(simulateTemperature, 3000); // Simulate every 3 seconds
    
    
        // Function to download the Temperature and Humidity data as an Excel file
    window.downloadTempExcel = function() {
        const ws = XLSX.utils.json_to_sheet(temperatureData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Temperature and Humidity Data');
        XLSX.writeFile(wb, 'temperature_humidity_data.xlsx');
    }
});

</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize chart data
    let labels = [];
    let data1 = [];
    let data2 = [];

    // Initialize Chart.js instance
    let ctx = document.getElementById('myChart').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                    label: 'OD1',
                    data: data1,
                    backgroundColor: 'rgba(255, 165, 0, 1)', // No background color
                    borderColor: 'rgba(255, 165, 0, 1)', // Bright Yellow
                    borderWidth: 2,
                    fill: false // Do not fill under the line
                },
                {
                    label: 'OD2',
                    data: data2,
                    backgroundColor: 'rgba(128, 0, 128, 1)', // No background color
                    borderColor: 'rgba(128, 0, 128, 1)', // Bright Red
                    borderWidth: 2,
                    fill: false // Do not fill under the line
                },
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 5, // Set maximum value for Y axis
                    ticks: {
                        stepSize: 0.1,
                        color: '#E0E0E0' // Light text color
                    },
                    title: {
                        display: true,
                        text: 'OD 600',
                        color: '#E0E0E0' // Light text color
                    },
                    grid: {
                        color: '#3A3A3A' // Grid line color
                    }
                },
                x: {
                    ticks: {
                        color: '#E0E0E0' // Light text color
                    },
                    title: {
                        display: true,
                        text: 'Time',
                        color: '#E0E0E0' // Light text color
                    },
                    grid: {
                        color: '#3A3A3A' // Grid line color
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#E0E0E0' // Light text color
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.7)', // Dark tooltip background
                    titleColor: '#E0E0E0', // Light text color for tooltip title
                    bodyColor: '#E0E0E0', // Light text color for tooltip body
                    borderColor: '#E0E0E0', // Light border color for tooltip
                    borderWidth: 1
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeInOutQuart'
            }
        }
    });

    // Store ADC values for download
    const adcData = [];

    // Function to update chart data with new row data
    function updateChart(newLabel, newData1, newData2) {
        labels.push(newLabel);
        data1.push(newData1);
        data2.push(newData2);

        // Update the chart
        myChart.update();

        // Store the data for download
        adcData.push({
            timestamp: newLabel,
            od1: newData1,
            od2: newData2
        });

        // Update ADC values
        document.getElementById('adc1').innerHTML = isNaN(newData1) ? "NaN" : newData1.toFixed(2);
        document.getElementById('adc2').innerHTML = isNaN(newData2) ? "NaN" : newData2.toFixed(2);

        // Update the SVG circles
        const circle3 = document.getElementById('circle3').querySelector('circle:nth-child(2)');
        const circle4 = document.getElementById('circle4').querySelector('circle:nth-child(2)');
        const radius3 = circle3.r.baseVal.value;
        const radius4 = circle4.r.baseVal.value;
        const circumference3 = 2 * Math.PI * radius3;
        const circumference4 = 2 * Math.PI * radius4;
        const offset3 = circumference3 - (isNaN(newData1) ? 0 : (newData1 / 5) * circumference3); // Adjusted to OD scale
        const offset4 = circumference4 - (isNaN(newData2) ? 0 : (newData2 / 5) * circumference4); // Adjusted to OD scale
        circle3.style.strokeDasharray = `${circumference3}`;
        circle3.style.strokeDashoffset = `${offset3}`;
        circle4.style.strokeDasharray = `${circumference4}`;
        circle4.style.strokeDashoffset = `${offset4}`;
    }

    let od1 = 0.1;
    let od2 = 0.4;

    // Function to simulate ADC data
     function simulateAndPlotData() {
        let newLabel = new Date().toLocaleTimeString();

        // Increment OD1 by a random value between 0.05 and 0.1 until it reaches 1
        if (od1 < 3) {
            od1 += Math.random() * (0.09 - 0.01) + 0.01;

            if (od1 > 3) od1 = 3; // Ensure OD1 does not exceed 1
        }

        // Increment OD2 by a random value between 0.05 and 0.1 until it reaches 1
        if (od2 < 3) {
            od2 += Math.random() * (0.09 - 0.01) + 0.01;

            if (od2 > 3) od2 = 3; // Ensure OD2 does not exceed 1
        }


        updateChart(newLabel, od1, od2);
    }

    // Simulate data and update chart initially
    simulateAndPlotData();

    // Set interval to simulate data and update chart periodically
    setInterval(simulateAndPlotData, 2000); // Update every 2 seconds

    // Function to download the Excel file
    window.downloadExcel = function() {
        const ws = XLSX.utils.json_to_sheet(adcData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'ADC Data');
        XLSX.writeFile(wb, 'od_data.xlsx');
    }
});
</script>



<script>
    function updateBoxStatus() {
        fetch('/box_status')
            .then(response => response.json())
            .then(data => {
                const status = data.box_status;
                const statusElement = document.getElementById('boxStatus');

                statusElement.innerText = status;

                if (status === 'Open') {
                    statusElement.style.color = 'var(--green)';
                } else {
                    statusElement.style.color = 'var(--red)';
                }
            })
            .catch(error => {
                console.error('Error fetching box status:', error);
            });
    }

    // Initial call to set the status on page load
    updateBoxStatus();
    
    // Update the status whenever an interrupt occurs
    setInterval(updateBoxStatus, 1000); // Update every second
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    function showTab(tabId, menuId) {
        document.querySelectorAll('.content-item').forEach(item => item.style.display = 'none');
        document.querySelectorAll('.menu-bar ul li').forEach(item => item.classList.remove('active'));
        document.getElementById(tabId).style.display = 'block';
        document.getElementById(menuId).classList.add('active');
    }

    function fetchCurrentSettings() {
        fetch('/currentSettings')
            .then(response => response.json())
            .then(data => {
                document.getElementById('pwm1').value = data.pwm1;
                document.getElementById('pwm2').value = data.pwm2;
                document.getElementById('v01').value = data.v01;
                document.getElementById('v02').value = data.v02;
            })
            .catch(error => console.error('Error fetching current settings:', error));
    }

    document.querySelectorAll('.menu-bar ul li a').forEach(item => {
        item.addEventListener('click', function(event) {
            const href = event.currentTarget.getAttribute('href').substring(1);
            const menuId = event.currentTarget.parentNode.id;
            showTab(href, menuId);
            if (href === 'set-auto') fetchCurrentSettings();
        });
    });

    document.querySelector('.setting').addEventListener('click', function() {
        showTab('set-auto', 'menu-set-auto');
        fetchCurrentSettings();
    });

    showTab('tong-quan', 'menu-dashboard');
});

function saveSettings() {
    const settings = {
        pwm1: document.getElementById('pwm1').value,
        pwm2: document.getElementById('pwm2').value,
        v01: document.getElementById('v01').value,
        v02: document.getElementById('v02').value
    };

    fetch('/saveSettings', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => { alert('Settings saved successfully!'); })
    .catch(error => console.error('Error saving settings:', error));
}

</script>


</body>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</html>
